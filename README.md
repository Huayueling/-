# 田字格检测模型项目 README

## 一、项目概述
本项目基于 **YOLOv8** 模型，实现对田字格图片中 **“空白田字格”** 和 **“有字田字格”** 的检测与分类。通过标注好的数据集训练模型，最终可自动识别图片中的两类田字格并输出检测结果，助力字帖内容分析与数字化处理。

## 二、数据集说明
### （一）数据结构  
数据集遵循 YOLO 标准格式，文件目录组织如下：  
```plaintext
dataset/
├─ images/         # 图片总目录
│  ├─ train/       # 训练集图片（含空白、有字田字格样本 ）
│  └─ val/         # 验证集图片（用于训练过程校验 ）
└─ data.yaml       # 数据集配置文件（定义类别、路径等 ）
```

### （二）标注信息  
- **标注工具**：使用 `labelImg` 软件完成田字格区域标注。  
- **类别定义**（对应 `data.yaml` ）：  
  - `0`：空白田字格（无书写内容的田字格区域 ）  
  - `1`：有字田字格（包含汉字/字符的田字格区域 ）  


## 三、环境要求  
### （一）基础环境  
- Python 版本：`3.8` 及以上  

### （二）依赖库  
- 核心框架：`ultralytics`（YOLOv8 官方库 ）、`torch`（建议启用 CUDA 加速 ）  
- 辅助工具：`opencv-python`（用于图像预处理/后处理 ）  
- 安装命令：  
  ```bash
  pip install -r requirements.txt 
  ```  
  *（注：需确保本地环境已正确配置 CUDA 驱动，以支持 GPU 加速 ）*  


## 四、训练说明  
### （一）训练配置  
- **基础模型**：`YOLOv8s`（预训练权重 `yolov8s.pt` ）  
- **关键参数**（可在训练代码中调整 ）：  
  | 参数项          | 配置值                     | 说明                     |  
  |-----------------|--------------------------|--------------------------|  
  | 训练轮次        | `300 epochs`             | 模型迭代学习次数          |  
  | 批次大小        | `16`                     | 每轮训练的样本批量        |  
  | 输入尺寸        | `640x640`                | 图片缩放后尺寸           |  
  | 初始学习率      | `0.001`                  | 控制参数更新步长          |  
  | 数据增强        | 启用（HSV 调整、旋转、缩放等 ） | 提升模型泛化能力          |  
  | 训练设备        | `GPU（CUDA）`            | 建议使用 GPU 加速训练     |  


### （二）训练流程  
1. **数据准备**：将标注好的图片按 `train/`、`val/` 分类，放入 `dataset/images/` 对应目录。  
2. **配置修改**：编辑 `data.yaml`，确保 `train`、`val` 路径与实际数据集目录一致，同时确认 `names` 类别映射正确（`0: 空白田字格`、`1: 有字田字格` ）。  
3. **启动训练**：运行训练脚本：  
   ```bash
   python 训练代码_优化.py 
   ```  
4. **结果保存**：训练权重默认保存至 `F:\pycahrm\untitled\write\dataset\model\tianzi_grid_model`，含最终模型 `best.pt`。  


## 五、测试说明  
### （一）测试流程  
1. **模型准备**：确认训练生成的 `best.pt` 存在（默认路径：`model\tianzi_grid_model3\weights\best.pt` ，若路径变更需同步修改测试代码 ）。  
2. **路径配置**：在测试脚本中，替换测试图片的路径为实际待检测图片路径。  
3. **执行检测**：运行测试脚本：  
   ```bash
   python 测试模型的检测能力.py 
   ```  
4. **结果可视化**：程序会输出带检测框的图片，**蓝色框标记有字田字格区域**，并显示检测置信度（预测为有字田字格的概率 ）。  


### （二）注意事项  
- **类别映射特殊处理**：标注时 `0` 代表空白田字格，但测试代码中通过 `if box.cls == 0` 筛选 **有字田字格**，使用时需注意逻辑一致性。  
- **检测严格度调整**：可修改测试代码中 `conf` 参数（置信度阈值 ），控制检测结果的严格程度（如 `conf=0.5` 代表仅保留置信度 ≥50% 的预测 ）。  


## 六、模型评估  
训练完成后，`ultralytics` 会自动输出评估指标，核心关注：  
- **mAP@0.5**：IoU（交并比 ）=0.5 时的平均精度，反映模型在田字格检测任务中的整体性能，值越高说明检测效果越好。  


## 七、常见问题  
| 问题场景                  | 解决方案                                                                 |  
|-------------------------|----------------------------------------------------------------------|  
| **模型文件不存在**        | 检查路径拼写、斜杠方向（Windows 系统建议用 `\` ，Linux/Mac 用 `/` ），确认训练是否正常完成  |  
| **检测结果不准确**        | 增加训练数据量（补充更多空白/有字田字格样本 ）、强化数据增强（如增加旋转角度、光照变换 ）或延长训练轮次  |  
| **GPU 内存不足**          | 减小 `batch_size`（如从 `16` 调整为 `8` ），或降低 `imgsz`（如从 `640x640` 改为 `320x320` ） |  


通过以上说明，可快速上手田字格检测模型的训练、测试与优化，若需进一步扩展功能（如批量检测、结果统计 ），可基于现有代码二次开发。
